[["planning-a-multi-location-design.html", "Day 26 Planning a multi-location design 26.1 Announcements 26.2 Planning a multi-environment trial", " Day 26 Planning a multi-location design July 17th, 2025 26.1 Announcements HW 4 due tomorrow Project due next Wednesday (July 23) for peer review. 26.2 Planning a multi-environment trial Objectives: Cover more variability in the target environment Increase number of repetitions Different approaches to picking multiple locations: 26.2.1 The importance of sample size “The truth wears off” by Jonah Lehrer [link] 26.2.2 What do multi-environment trials look like? 1. Open the required packages library(tidyverse) # data wrangling &amp; data viz library(lme4) # model fitting library(emmeans) # marginal means library(latex2exp) # math notation for plots 2. Set the “true” values Click to show code # This code will run and be hidden by default x &lt;- rnorm(100) summary(x) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## -2.349149 -0.628797 0.046397 -0.002698 0.586722 2.435636 sigma_env.truth &lt;- 35 sigma_block.truth &lt;- 3 sigma.truth &lt;- 10 trts &lt;- paste(&quot;t&quot;, 11:40, sep = &quot;&quot;) n_envs &lt;- 10 n_rep &lt;- 3 df_me &lt;- expand.grid(trt = trts, rep = 1:n_rep, environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;)) env_re &lt;- rnorm(n_envs, 0, sigma_env.truth) block_re &lt;- rnorm(n_envs*n_rep, 0, sigma_block.truth) df_envs &lt;- data.frame(environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;), env_re) df_blocks &lt;- expand.grid(environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;), rep = 1:n_rep) %&gt;% mutate(block_re = block_re) df_me &lt;- df_me %&gt;% mutate(mu_t = case_when(trt == &quot;10&quot; ~ 200, trt == &quot;11&quot; ~ 200, trt == &quot;12&quot; ~ 180, TRUE ~ 220)) %&gt;% left_join(df_envs) %&gt;% left_join(df_blocks) %&gt;% mutate(e = rnorm(nrow(df_me), 0, sigma.truth), y = mu_t + env_re + block_re + e) ## Joining with `by = join_by(environm)` ## Joining with `by = join_by(rep, environm)` m &lt;- lmer(y ~ trt + (1|environm/rep), data = df_me) emmeans(m, ~ trt, contr = list(c(1, -1, rep(0, 28)))) ## $emmeans ## trt emmean SE df lower.CL upper.CL ## t11 231 14.5 9.27 198 263 ## t12 228 14.5 9.27 195 261 ## t13 227 14.5 9.27 195 260 ## t14 229 14.5 9.27 197 262 ## t15 230 14.5 9.27 197 262 ## t16 228 14.5 9.27 196 261 ## t17 226 14.5 9.27 194 259 ## t18 229 14.5 9.27 196 262 ## t19 228 14.5 9.27 196 261 ## t20 229 14.5 9.27 196 261 ## t21 229 14.5 9.27 197 262 ## t22 225 14.5 9.27 193 258 ## t23 230 14.5 9.27 197 263 ## t24 229 14.5 9.27 196 261 ## t25 230 14.5 9.27 197 262 ## t26 227 14.5 9.27 194 260 ## t27 231 14.5 9.27 198 263 ## t28 231 14.5 9.27 198 263 ## t29 231 14.5 9.27 198 264 ## t30 228 14.5 9.27 196 261 ## t31 231 14.5 9.27 198 263 ## t32 228 14.5 9.27 195 261 ## t33 228 14.5 9.27 195 260 ## t34 230 14.5 9.27 197 263 ## t35 225 14.5 9.27 192 257 ## t36 227 14.5 9.27 195 260 ## t37 227 14.5 9.27 194 259 ## t38 228 14.5 9.27 195 261 ## t39 228 14.5 9.27 195 260 ## t40 227 14.5 9.27 194 260 ## ## Degrees-of-freedom method: kenward-roger ## Confidence level used: 0.95 ## ## $contrasts ## contrast estimate SE ## c(1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.79 2.52 ## df t.ratio p.value ## 841 1.108 0.2684 ## ## Degrees-of-freedom method: kenward-roger sigma_env.truth &lt;- 35 sigma_block.truth &lt;- 3 sigma.truth &lt;- 10 trts &lt;- paste(&quot;t&quot;, 11:40, sep = &quot;&quot;) n_envs &lt;- 2 n_rep &lt;- 3 df_me &lt;- expand.grid(trt = trts, rep = 1:n_rep, environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;)) env_re &lt;- rnorm(n_envs, 0, sigma_env.truth) block_re &lt;- rnorm(n_envs*n_rep, 0, sigma_block.truth) df_envs &lt;- data.frame(environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;), env_re) df_blocks &lt;- expand.grid(environm = paste(&quot;e&quot;, 11:(10+n_envs), sep = &quot;&quot;), rep = 1:n_rep) %&gt;% mutate(block_re = block_re) df_me &lt;- df_me %&gt;% mutate(mu_t = case_when(trt == &quot;10&quot; ~ 200, trt == &quot;11&quot; ~ 200, trt == &quot;12&quot; ~ 180, TRUE ~ 220)) %&gt;% left_join(df_envs) %&gt;% left_join(df_blocks) %&gt;% mutate(e = rnorm(nrow(df_me), 0, sigma.truth), y = mu_t + env_re + block_re + e) ## Joining with `by = join_by(environm)` ## Joining with `by = join_by(rep, environm)` m &lt;- lmer(y ~ trt + (1|environm/rep), data = df_me) emmeans(m, ~ trt, contr = list(c(1, -1, rep(0, 28)))) ## $emmeans ## trt emmean SE df lower.CL upper.CL ## t11 232 25.2 1.05 -57.5 521 ## t12 230 25.2 1.05 -59.4 519 ## t13 220 25.2 1.05 -69.2 509 ## t14 228 25.2 1.05 -60.9 518 ## t15 231 25.2 1.05 -58.2 520 ## t16 230 25.2 1.05 -58.9 520 ## t17 224 25.2 1.05 -65.1 514 ## t18 225 25.2 1.05 -64.0 515 ## t19 222 25.2 1.05 -67.7 511 ## t20 225 25.2 1.05 -63.9 515 ## t21 224 25.2 1.05 -65.0 514 ## t22 234 25.2 1.05 -54.9 524 ## t23 228 25.2 1.05 -61.4 517 ## t24 226 25.2 1.05 -63.0 516 ## t25 224 25.2 1.05 -65.1 514 ## t26 228 25.2 1.05 -61.0 518 ## t27 220 25.2 1.05 -69.2 509 ## t28 227 25.2 1.05 -62.0 517 ## t29 230 25.2 1.05 -59.1 519 ## t30 224 25.2 1.05 -65.4 513 ## t31 222 25.2 1.05 -67.7 511 ## t32 225 25.2 1.05 -64.4 514 ## t33 226 25.2 1.05 -63.4 515 ## t34 224 25.2 1.05 -65.6 513 ## t35 226 25.2 1.05 -62.8 516 ## t36 231 25.2 1.05 -58.6 520 ## t37 230 25.2 1.05 -59.2 519 ## t38 220 25.2 1.05 -69.2 509 ## t39 231 25.2 1.05 -57.8 521 ## t40 222 25.2 1.05 -67.8 511 ## ## Degrees-of-freedom method: kenward-roger ## Confidence level used: 0.95 ## ## $contrasts ## contrast estimate SE ## c(1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.83 5.4 ## df t.ratio p.value ## 145 0.339 0.7354 ## ## Degrees-of-freedom method: kenward-roger "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
